---
layout: base.njk
title: Writer Drafts - Rob Spain
permalink: /admin/drafts/
---

<div class="admin-dashboard-premium">
    <div class="container">
        <div class="section-header-premium animate-fade-up">
            <div class="section-badge-premium">Content Management</div>
            <h2 class="section-title-premium">
                Writer <span class="text-gradient">Drafts</span>
            </h2>
            <p class="section-description-premium">
                Review and manage draft content from AI writers. Check off drafts when reviewed or published.
            </p>
        </div>

        <div class="dashboard-grid-premium animate-fade-up stagger-1">
            <!-- Drafts List Card -->
            <div class="dashboard-card-premium card-highlight">
                <div class="card-icon-premium" style="background: rgba(139, 92, 246, 0.1);">
                    <i class="fas fa-file-alt" style="color: #8b5cf6;"></i>
                </div>
                <div class="card-content-premium">
                    <h3>üìù Drafts Dashboard</h3>
                    <p>View all writer drafts in a sortable, filterable table. Mark as reviewed, publish, or archive.</p>
                    <div id="drafts-list" class="mt-4">
                        <p class="text-slate-500">Loading drafts...</p>
                    </div>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="dashboard-card-premium">
                <div class="card-icon-premium" style="background: rgba(16, 185, 129, 0.1);">
                    <i class="fas fa-chart-bar" style="color: #10b981;"></i>
                </div>
                <div class="card-content-premium">
                    <h3>üìä Draft Statistics</h3>
                    <div id="draft-stats" class="mt-4">
                        <p class="text-slate-500">Loading statistics...</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Card -->
            <div class="dashboard-card-premium">
                <div class="card-icon-premium" style="background: rgba(59, 130, 246, 0.1);">
                    <i class="fas fa-bolt" style="color: #3b82f6;"></i>
                </div>
                <div class="card-content-premium">
                    <h3>‚ö° Quick Actions</h3>
                    <div class="space-y-3 mt-4">
                        <button onclick="loadAllDrafts()" class="w-full bg-blue-100 hover:bg-blue-200 text-blue-700 font-medium py-2 px-4 rounded-lg transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i> Refresh Drafts List
                        </button>
                        <button onclick="markAllReviewed()" class="w-full bg-emerald-100 hover:bg-emerald-200 text-emerald-700 font-medium py-2 px-4 rounded-lg transition-colors">
                            <i class="fas fa-check-circle mr-2"></i> Mark All as Reviewed
                        </button>
                        <button onclick="exportDrafts()" class="w-full bg-purple-100 hover:bg-purple-200 text-purple-700 font-medium py-2 px-4 rounded-lg transition-colors">
                            <i class="fas fa-download mr-2"></i> Export to CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.draft-item {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 0.75rem;
    transition: all 0.2s ease;
}

.draft-item:hover {
    border-color: #8b5cf6;
    box-shadow: 0 4px 6px -1px rgba(139, 92, 246, 0.1);
}

.draft-item.reviewed {
    opacity: 0.7;
    background: #f8fafc;
}

.draft-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
}

.draft-title {
    font-weight: 600;
    color: #1e293b;
    flex: 1;
}

.draft-actions {
    display: flex;
    gap: 0.5rem;
}

.draft-meta {
    display: flex;
    gap: 1rem;
    font-size: 0.875rem;
    color: #64748b;
    margin-bottom: 0.5rem;
}

.draft-preview {
    color: #475569;
    font-size: 0.875rem;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.status-badge {
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
}

.status-new {
    background: #fef3c7;
    color: #92400e;
}

.status-reviewed {
    background: #d1fae5;
    color: #065f46;
}

.status-published {
    background: #dbeafe;
    color: #1e40af;
}

.btn-small {
    padding: 0.25rem 0.75rem;
    font-size: 0.75rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-review {
    background: #10b981;
    color: white;
}

.btn-review:hover {
    background: #059669;
}

.btn-view {
    background: #3b82f6;
    color: white;
}

.btn-view:hover {
    background: #2563eb;
}

.btn-delete {
    background: #ef4444;
    color: white;
}

.btn-delete:hover {
    background: #dc2626;
}
</style>

<script>
// Drafts data structure
let drafts = [];
let draftStatus = {};

// Load draft status from localStorage
function loadDraftStatus() {
    const saved = localStorage.getItem('draftStatus');
    if (saved) {
        draftStatus = JSON.parse(saved);
    }
}

// Save draft status to localStorage
function saveDraftStatus() {
    localStorage.setItem('draftStatus', JSON.stringify(draftStatus));
}

// Fetch drafts from the server
async function fetchDrafts() {
    try {
        // In a real implementation, this would fetch from an API endpoint
        // For now, we'll simulate with a mock response
        const response = await fetch('/api/drafts');
        if (response.ok) {
            drafts = await response.json();
        } else {
            // Fallback to mock data
            drafts = await getMockDrafts();
        }
    } catch (error) {
        console.error('Error fetching drafts:', error);
        drafts = await getMockDrafts();
    }
    renderDrafts();
    renderStats();
}

// Mock drafts data (replace with real API call)
async function getMockDrafts() {
    // This would be replaced with a real API call to /api/drafts
    // For now, return empty array - real implementation would need server-side endpoint
    return [];
}

// Render drafts list
function renderDrafts() {
    const container = document.getElementById('drafts-list');
    if (drafts.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8">
                <i class="fas fa-file-alt text-4xl text-slate-300 mb-4"></i>
                <p class="text-slate-500">No drafts found.</p>
                <p class="text-slate-400 text-sm mt-2">Drafts are automatically added by AI writers.</p>
            </div>
        `;
        return;
    }

    let html = '<div class="space-y-3">';
    
    drafts.forEach(draft => {
        const status = draftStatus[draft.id] || 'new';
        const statusClass = status === 'reviewed' ? 'draft-item reviewed' : 'draft-item';
        
        html += `
            <div class="${statusClass}" data-id="${draft.id}">
                <div class="draft-header">
                    <div class="draft-title">${draft.title}</div>
                    <div class="draft-actions">
                        <span class="status-badge status-${status}">${status}</span>
                        <button class="btn-small btn-view" onclick="viewDraft('${draft.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${status === 'new' ? `
                        <button class="btn-small btn-review" onclick="markReviewed('${draft.id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        ` : ''}
                        <button class="btn-small btn-delete" onclick="deleteDraft('${draft.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="draft-meta">
                    <span><i class="far fa-calendar mr-1"></i> ${draft.date}</span>
                    <span><i class="fas fa-tag mr-1"></i> ${draft.type}</span>
                    <span><i class="fas fa-user-edit mr-1"></i> ${draft.author}</span>
                </div>
                <div class="draft-preview">${draft.preview}</div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

// Render statistics
function renderStats() {
    const container = document.getElementById('draft-stats');
    const total = drafts.length;
    const reviewed = Object.values(draftStatus).filter(s => s === 'reviewed').length;
    const newCount = total - reviewed;
    
    container.innerHTML = `
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-blue-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-blue-700">${total}</div>
                <div class="text-sm text-blue-600">Total Drafts</div>
            </div>
            <div class="bg-emerald-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-emerald-700">${reviewed}</div>
                <div class="text-sm text-emerald-600">Reviewed</div>
            </div>
            <div class="bg-amber-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-amber-700">${newCount}</div>
                <div class="text-sm text-amber-600">New</div>
            </div>
            <div class="bg-purple-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-purple-700">${Math.round((reviewed / total) * 100) || 0}%</div>
                <div class="text-sm text-purple-600">Completion</div>
            </div>
        </div>
    `;
}

// Mark a draft as reviewed
function markReviewed(draftId) {
    draftStatus[draftId] = 'reviewed';
    saveDraftStatus();
    renderDrafts();
    renderStats();
    
    // Show confirmation
    showToast('Draft marked as reviewed', 'success');
}

// Mark all drafts as reviewed
function markAllReviewed() {
    if (confirm('Mark all drafts as reviewed?')) {
        drafts.forEach(draft => {
            draftStatus[draft.id] = 'reviewed';
        });
        saveDraftStatus();
        renderDrafts();
        renderStats();
        showToast('All drafts marked as reviewed', 'success');
    }
}

// View a draft
function viewDraft(draftId) {
    const draft = drafts.find(d => d.id === draftId);
    if (draft) {
        // In a real implementation, this would open the draft in an editor or modal
        alert(`Viewing draft: ${draft.title}\n\n${draft.preview}\n\nFull content would be displayed here.`);
    }
}

// Delete a draft
function deleteDraft(draftId) {
    if (confirm('Delete this draft? This action cannot be undone.')) {
        // In a real implementation, this would call DELETE /api/drafts/{id}
        drafts = drafts.filter(d => d.id !== draftId);
        delete draftStatus[draftId];
        saveDraftStatus();
        renderDrafts();
        renderStats();
        showToast('Draft deleted', 'warning');
    }
}

// Export drafts to CSV
function exportDrafts() {
    const csv = [
        ['ID', 'Title', 'Date', 'Type', 'Author', 'Status', 'Preview'],
        ...drafts.map(draft => [
            draft.id,
            draft.title,
            draft.date,
            draft.type,
            draft.author,
            draftStatus[draft.id] || 'new',
            draft.preview.replace(/"/g, '""')
        ])
    ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `drafts-export-${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showToast('Drafts exported to CSV', 'success');
}

// Load all drafts
function loadAllDrafts() {
    fetchDrafts();
    showToast('Refreshing drafts list...', 'info');
}

// Show toast notification
function showToast(message, type = 'info') {
    // Simple toast implementation
    const toast = document.createElement('div');
    toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 ${
        type === 'success' ? 'bg-emerald-500 text-white' :
        type === 'warning' ? 'bg-amber-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        'bg-blue-500 text-white'
    }`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    loadDraftStatus();
    fetchDrafts();
});
</script>

<!-- Note: This page needs a backend API endpoint at /api/drafts to function fully.
     The endpoint should return draft data from /Users/Neo/clawd/agents/writer/drafts/
     and handle status updates. For now, it uses mock data. -->