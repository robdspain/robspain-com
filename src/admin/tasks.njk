---
layout: base.njk
title: Neo Dashboard v2 - Rob Spain Admin
permalink: /admin/tasks/
---

<style>
  .neo-dashboard {
    background: var(--background-slate);
    min-height: 100vh;
    padding: 2.5rem 1.5rem 4rem;
    color: var(--text-primary);
  }

  .neo-shell {
    max-width: 1400px;
    margin: 0 auto;
  }

  .neo-header {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-bottom: 2.5rem;
  }

  .neo-title {
    font-size: 2.25rem;
    font-weight: 800;
    letter-spacing: -0.02em;
  }

  .neo-subtitle {
    color: var(--text-secondary);
    margin-top: 0.25rem;
  }

  .neo-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .neo-btn {
    border: none;
    border-radius: 999px;
    padding: 0.65rem 1.3rem;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .neo-btn-primary {
    background: var(--gradient-emerald);
    color: #ffffff;
    box-shadow: var(--shadow-md);
  }

  .neo-btn-secondary {
    background: #ffffff;
    color: var(--text-primary);
    border: 1px solid var(--border-color);
  }

  .neo-btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    border: 1px dashed var(--border-color);
  }

  .neo-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .neo-status-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0.35rem 0.7rem;
    border-radius: 999px;
  }

  .status-active { background: #dcfce7; color: #166534; }
  .status-blocked { background: #fef3c7; color: #92400e; }
  .status-done { background: #e0f2fe; color: #075985; }
  .status-paused { background: #e2e8f0; color: #475569; }

  .neo-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .panel {
    background: #ffffff;
    border-radius: 24px;
    padding: 1.75rem;
    box-shadow: var(--shadow-md);
    border: 1px solid rgba(15, 23, 42, 0.06);
  }

  .panel-header {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }

  .panel-title {
    font-size: 1.3rem;
    font-weight: 700;
  }

  .panel-subtitle {
    color: var(--text-secondary);
    font-size: 0.95rem;
  }

  .dashboard-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  .project-cards {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .project-card {
    border-radius: 18px;
    border: 1px solid rgba(15, 23, 42, 0.08);
    padding: 1.2rem;
    background: #f8fafc;
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .project-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .project-card.expanded {
    background: #ffffff;
  }

  .project-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
  }

  .project-name {
    font-size: 1.05rem;
    font-weight: 700;
    display: flex;
    gap: 0.6rem;
    align-items: center;
  }

  .project-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
  }

  .progress-track {
    background: #e2e8f0;
    border-radius: 999px;
    overflow: hidden;
    height: 10px;
  }

  .progress-fill {
    height: 100%;
    border-radius: 999px;
    background: var(--gradient-emerald);
  }

  .progress-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 0.85rem;
    color: var(--text-secondary);
  }

  .project-details {
    display: none;
    border-top: 1px solid var(--border-color);
    padding-top: 0.9rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
    gap: 0.65rem;
  }

  .project-card.expanded .project-details {
    display: grid;
  }

  .project-detail-row {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
  }

  .project-detail-label {
    font-weight: 600;
    color: var(--text-primary);
  }

  .project-link {
    color: var(--secondary-color);
    text-decoration: none;
    font-weight: 600;
  }

  .blocked-section {
    margin-top: 1.5rem;
    background: #fff7ed;
    border-radius: 16px;
    padding: 1.25rem;
    border: 1px solid #fed7aa;
  }

  .blocked-list {
    display: grid;
    gap: 0.75rem;
    margin-top: 0.75rem;
  }

  .blocked-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    background: #ffffff;
    border-radius: 12px;
    padding: 0.75rem 1rem;
    border: 1px solid #fed7aa;
  }

  .blocked-item button {
    border: none;
    background: #f97316;
    color: #ffffff;
    font-weight: 600;
    padding: 0.4rem 0.8rem;
    border-radius: 999px;
    cursor: pointer;
  }

  .quick-wins-list {
    display: grid;
    gap: 0.9rem;
  }

  .quick-win {
    border: 1px solid rgba(15, 23, 42, 0.08);
    border-radius: 16px;
    padding: 1rem 1.2rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    background: #f8fafc;
  }

  .quick-win-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
  }

  .quick-win-title {
    font-weight: 700;
    font-size: 1rem;
  }

  .quick-win-estimate {
    font-size: 0.8rem;
    font-weight: 700;
    color: #0f766e;
    background: #ccfbf1;
    padding: 0.2rem 0.6rem;
    border-radius: 999px;
  }

  .quick-win-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .quick-win-actions button,
  .quick-win-actions a {
    text-decoration: none;
    border: none;
    background: #e2e8f0;
    color: #1f2937;
    padding: 0.45rem 0.8rem;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
  }

  .quick-win-actions .primary {
    background: #10b981;
    color: #ffffff;
  }

  .quick-win-actions .done {
    background: #0f172a;
    color: #ffffff;
  }

  .quick-win-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    color: var(--text-secondary);
  }

  .quick-wins-footer {
    margin-top: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .calendar-shell {
    display: grid;
    gap: 1.5rem;
  }

  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .calendar-nav {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .calendar-nav button {
    border: 1px solid var(--border-color);
    background: #ffffff;
    padding: 0.4rem 0.7rem;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, minmax(0, 1fr));
    gap: 0.5rem;
  }

  .calendar-weekday {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-light);
    text-align: center;
  }

  .calendar-day {
    background: #f8fafc;
    border: 1px solid rgba(15, 23, 42, 0.08);
    border-radius: 12px;
    min-height: 90px;
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    cursor: pointer;
    position: relative;
  }

  .calendar-day.inactive {
    opacity: 0.4;
  }

  .calendar-day.today {
    border-color: #10b981;
    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
  }

  .calendar-date {
    font-weight: 700;
    font-size: 0.85rem;
  }

  .calendar-items {
    display: flex;
    flex-wrap: wrap;
    gap: 0.2rem;
  }

  .calendar-item {
    font-size: 0.75rem;
    background: #e2e8f0;
    padding: 0.15rem 0.45rem;
    border-radius: 999px;
  }

  .calendar-item.status-review { background: #fef3c7; color: #92400e; }
  .calendar-item.status-approved { background: #dcfce7; color: #166534; }
  .calendar-item.status-drafting { background: #e0e7ff; color: #3730a3; }
  .calendar-item.status-idea { background: #f1f5f9; color: #475569; }
  .calendar-item.status-published { background: #cffafe; color: #0e7490; }

  .calendar-detail {
    background: #f8fafc;
    border-radius: 16px;
    padding: 1.25rem;
    border: 1px solid rgba(15, 23, 42, 0.08);
  }

  .calendar-detail h4 {
    margin-bottom: 0.75rem;
  }

  .calendar-detail-list {
    display: grid;
    gap: 0.75rem;
  }

  .content-card {
    background: #ffffff;
    border-radius: 12px;
    padding: 0.75rem 1rem;
    border: 1px solid rgba(15, 23, 42, 0.08);
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .content-card-header {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    align-items: center;
    font-weight: 600;
  }

  .content-card-actions {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
  }

  .content-card-actions button,
  .content-card-actions a {
    border: none;
    background: #e2e8f0;
    color: #1f2937;
    padding: 0.35rem 0.7rem;
    border-radius: 10px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
  }

  .content-card-actions .primary {
    background: #10b981;
    color: #ffffff;
  }

  .upcoming-list {
    display: grid;
    gap: 0.8rem;
  }

  .upcoming-item {
    border-radius: 14px;
    background: #ffffff;
    border: 1px solid rgba(15, 23, 42, 0.08);
    padding: 0.9rem 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .upcoming-item .meta {
    color: var(--text-secondary);
    font-size: 0.85rem;
  }

  .data-status {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    flex-wrap: wrap;
    font-size: 0.85rem;
    color: var(--text-secondary);
  }

  .data-status strong {
    color: var(--text-primary);
  }

  .connect-panel {
    background: #f8fafc;
    border: 1px dashed var(--border-color);
    border-radius: 14px;
    padding: 1rem;
    display: grid;
    gap: 0.75rem;
  }

  .connect-panel input {
    padding: 0.55rem 0.75rem;
    border-radius: 10px;
    border: 1px solid var(--border-color);
    font-size: 0.9rem;
    width: 100%;
  }

  .calendar-warning {
    background: #fef2f2;
    border-radius: 12px;
    padding: 0.75rem 1rem;
    border: 1px solid #fecaca;
    color: #7f1d1d;
    font-size: 0.85rem;
    font-weight: 600;
  }

  @media (min-width: 900px) {
    .neo-header {
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
    }

    .dashboard-grid {
      grid-template-columns: 1fr 1.4fr;
    }

    .project-cards {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .calendar-shell {
      grid-template-columns: 2fr 1fr;
    }
  }
</style>

<div class="neo-dashboard">
  <div class="neo-shell">
    <header class="neo-header">
      <div>
        <div class="neo-title">Neo Dashboard</div>
        <div class="neo-subtitle">Visual projects, fast wins, and content planning in one place.</div>
      </div>
      <div class="neo-actions">
        <button class="neo-btn neo-btn-primary" id="add-quick-win">+ Add Quick Win</button>
        <button class="neo-btn neo-btn-secondary" id="refresh-data">‚Üª Refresh</button>
        <button class="neo-btn neo-btn-ghost" id="toggle-connection">Supabase Settings</button>
      </div>
    </header>

    <div class="panel connect-panel" id="connection-panel" style="display:none;">
      <div class="data-status" id="connection-status">Data source: <strong>Sample data</strong></div>
      <div>
        <label for="supabase-url">Supabase URL</label>
        <input id="supabase-url" type="text" placeholder="https://xxxx.supabase.co" />
      </div>
      <div>
        <label for="supabase-key">Supabase anon key</label>
        <input id="supabase-key" type="password" placeholder="eyJhbGciOi..." />
      </div>
      <div class="neo-actions">
        <button class="neo-btn neo-btn-primary" id="save-connection">Save & Connect</button>
        <button class="neo-btn neo-btn-secondary" id="clear-connection">Use Sample Data</button>
      </div>
    </div>

    <div class="dashboard-grid">
      <section class="panel" id="quick-wins-section">
        <div class="panel-header">
          <div class="panel-title">‚ö° Quick Wins (5-15 min)</div>
          <div class="panel-subtitle">Knock out the fastest wins first. Sorted by time.</div>
        </div>
        <div class="quick-wins-list" id="quick-wins-list"></div>
        <div class="quick-wins-footer">
          <div class="data-status">Completed today: <strong id="quick-wins-done">0</strong></div>
          <div class="data-status">Next up: <strong id="quick-wins-next">‚Äî</strong></div>
        </div>
      </section>

      <section class="panel" id="projects-section">
        <div class="panel-header">
          <div class="panel-title">üìä Project Dashboard</div>
          <div class="panel-subtitle">Tap a card to expand. Progress and status update in real time.</div>
        </div>
        <div class="project-cards" id="project-cards"></div>
        <div class="blocked-section" id="blocked-section">
          <div class="panel-title">‚è∏Ô∏è Blocked / Waiting on Rob</div>
          <div class="blocked-list" id="blocked-list"></div>
        </div>
      </section>
    </div>

    <section class="panel" id="calendar-section" style="margin-top:1.5rem;">
      <div class="panel-header">
        <div class="panel-title">üìÖ Content Calendar</div>
        <div class="panel-subtitle">Monthly view with channel icons and quick approvals.</div>
      </div>
      <div class="calendar-shell">
        <div>
          <div class="calendar-header">
            <div>
              <div class="panel-title" id="calendar-month">February 2026</div>
              <div class="panel-subtitle">üìß Email ¬∑ üé• YouTube ¬∑ üíº LinkedIn ¬∑ üìù Blog ¬∑ üê¶ Twitter</div>
            </div>
            <div class="calendar-nav">
              <button id="prev-month">‚óÄ</button>
              <button id="today-month">Today</button>
              <button id="next-month">‚ñ∂</button>
            </div>
          </div>
          <div class="calendar-warning" id="calendar-warning" style="display:none;"></div>
          <div class="calendar-grid" id="calendar-weekdays"></div>
          <div class="calendar-grid" id="calendar-days"></div>
        </div>
        <div class="calendar-detail">
          <h4 id="calendar-detail-title">Select a date</h4>
          <div class="calendar-detail-list" id="calendar-detail-list"></div>
        </div>
      </div>
      <div style="margin-top:1.5rem;">
        <div class="panel-title">üìã Upcoming Content</div>
        <div class="panel-subtitle">Sorted by schedule date.</div>
        <div class="upcoming-list" id="upcoming-list"></div>
      </div>
    </section>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const channelIcons = {
    email: 'üìß',
    youtube: 'üé•',
    linkedin: 'üíº',
    twitter: 'üê¶',
    blog: 'üìù'
  };

  const sampleData = {
    projects: [
      {
        id: 'proj-1',
        name: 'IEP Goal Writer',
        emoji: 'üìù',
        status: 'active',
        progress: 42,
        phase: 'Building',
        blocked_reason: null,
        prd_path: '/documents/IEP_GOAL_WRITER_PRD.pdf',
        updated_at: '2026-01-31T20:30:00Z'
      },
      {
        id: 'proj-2',
        name: 'Learning Platform',
        emoji: 'üéì',
        status: 'active',
        progress: 82,
        phase: 'Audited ‚Äî fake data removal in progress',
        blocked_reason: null,
        prd_path: '/documents/LEARNING_PLATFORM_PRD.pdf',
        updated_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'proj-3',
        name: 'KCUSD Site',
        emoji: 'üè´',
        status: 'done',
        progress: 100,
        phase: 'Complete',
        blocked_reason: null,
        prd_path: '/documents/KCUSD_PRD.pdf',
        updated_at: '2026-01-29T19:20:00Z'
      },
      {
        id: 'proj-4',
        name: 'Neo iOS App',
        emoji: 'üì±',
        status: 'blocked',
        progress: 25,
        phase: 'Setup',
        blocked_reason: 'Apple Sign-In blocked on credentials; App Store submission pending',
        prd_path: null,
        updated_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'proj-5',
        name: 'OpenClaw Gateway Stack',
        emoji: 'ü¶û',
        status: 'done',
        progress: 100,
        phase: 'Complete',
        blocked_reason: null,
        prd_path: null,
        updated_at: '2026-02-07T06:40:00Z'
      },
      {
        id: 'proj-6',
        name: 'Voice Agent',
        emoji: 'üìû',
        status: 'done',
        progress: 100,
        phase: 'Prototype built ‚Äî trial account active',
        blocked_reason: null,
        prd_path: null,
        updated_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'proj-7',
        name: 'iOS Simulator Skill',
        emoji: 'üñ•Ô∏è',
        status: 'done',
        progress: 100,
        phase: 'Complete',
        blocked_reason: null,
        prd_path: null,
        updated_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'proj-8',
        name: 'Symposium Slides',
        emoji: 'üé§',
        status: 'blocked',
        progress: 60,
        phase: 'Needs import script run',
        blocked_reason: 'Import script needs to be run',
        prd_path: null,
        updated_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'proj-9',
        name: 'Training Videos',
        emoji: 'üé•',
        status: 'active',
        progress: 10,
        phase: 'Pre-production',
        blocked_reason: null,
        prd_path: null,
        updated_at: '2026-02-07T07:00:00Z'
      }
    ],
    quickWins: [
      {
        id: 'qw-4',
        title: 'Switch default model to Claude Opus 4.6',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T05:51:00Z',
        completed_at: '2026-02-07T05:52:00Z'
      },
      {
        id: 'qw-5',
        title: 'Set Codex as first coding fallback',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T06:28:00Z',
        completed_at: '2026-02-07T06:29:00Z'
      },
      {
        id: 'qw-6',
        title: 'Switch heartbeat to free Gemini Flash model',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T06:28:00Z',
        completed_at: '2026-02-07T06:29:00Z'
      },
      {
        id: 'qw-7',
        title: 'Add MiniMax API key to Gateway',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T06:33:00Z',
        completed_at: '2026-02-07T06:34:00Z'
      },
      {
        id: 'qw-8',
        title: 'Add DeepSeek R1, Maverick, Qwen 3 via OpenRouter',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T06:35:00Z',
        completed_at: '2026-02-07T06:36:00Z'
      },
      {
        id: 'qw-9',
        title: 'Add Grok 2, Grok 3 Mini, Mistral, Cohere via OpenRouter',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T06:36:00Z',
        completed_at: '2026-02-07T06:37:00Z'
      },
      {
        id: 'qw-10',
        title: 'Add direct xAI API key + Grok 3 models',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T06:37:00Z',
        completed_at: '2026-02-07T06:38:00Z'
      },
      {
        id: 'qw-11',
        title: 'Add direct Groq API key + Llama/Mixtral models',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T06:38:00Z',
        completed_at: '2026-02-07T06:38:00Z'
      },
      {
        id: 'qw-12',
        title: 'Build deep 10-model fallback chain across 6 providers',
        estimate_minutes: 10,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T06:39:00Z',
        completed_at: '2026-02-07T06:40:00Z'
      },
      {
        id: 'qw-13',
        title: 'Voice calls working (trial account)',
        estimate_minutes: 5,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T07:00:00Z',
        completed_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'qw-14',
        title: 'Video training funnel fixed',
        estimate_minutes: 10,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T07:00:00Z',
        completed_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'qw-15',
        title: 'Marketing calendar drafted',
        estimate_minutes: 15,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'done',
        created_at: '2026-02-07T07:00:00Z',
        completed_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'qw-1',
        title: 'Run Symposium slides import script',
        estimate_minutes: 10,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'pending',
        created_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'qw-2',
        title: 'Apple Sign-In setup (blocked on credentials)',
        estimate_minutes: 15,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'pending',
        created_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'qw-3',
        title: 'Email auth fix (blocked on bug report)',
        estimate_minutes: 10,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'pending',
        created_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'qw-16',
        title: 'Record training videos',
        estimate_minutes: 15,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'pending',
        created_at: '2026-02-07T07:00:00Z'
      },
      {
        id: 'qw-17',
        title: 'App Store submission',
        estimate_minutes: 15,
        type: 'action',
        preview_url: null,
        action_url: null,
        status: 'pending',
        created_at: '2026-02-07T07:00:00Z'
      }
    ],
    content: [
      {
        id: 'c-1',
        title: '5 Mistakes School BCBAs Make',
        channel: 'youtube',
        scheduled_date: '2026-02-04',
        status: 'review',
        preview_url: '/admin/preview/youtube-script',
        publish_url: null
      },
      {
        id: 'c-2',
        title: 'CalABA Preview - What I\'m Presenting',
        channel: 'email',
        scheduled_date: '2026-02-05',
        status: 'approved',
        preview_url: '/admin/preview/calaba-email',
        publish_url: null
      },
      {
        id: 'c-3',
        title: 'Top 3 Data Collection Fixes',
        channel: 'linkedin',
        scheduled_date: '2026-02-07',
        status: 'drafting',
        preview_url: '/admin/preview/linkedin-post',
        publish_url: null
      },
      {
        id: 'c-4',
        title: 'Behavior Study Tools February Newsletter',
        channel: 'email',
        scheduled_date: '2026-02-12',
        status: 'idea',
        preview_url: null,
        publish_url: null
      }
    ]
  };

  const state = {
    projects: [],
    quickWins: [],
    content: [],
    supabase: null,
    currentMonth: new Date(new Date().getFullYear(), new Date().getMonth(), 1),
    selectedDate: null
  };

  const weekdayLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

  function formatDate(date) {
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  }

  function formatDateLong(date) {
    return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
  }

  function formatTime(dateString) {
    const date = new Date(dateString);
    return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
  }

  function loadSupabaseConfig() {
    return {
      url: localStorage.getItem('neoSupabaseUrl'),
      key: localStorage.getItem('neoSupabaseAnonKey')
    };
  }

  function setConnectionStatus(label) {
    const el = document.getElementById('connection-status');
    if (el) {
      el.innerHTML = `Data source: <strong>${label}</strong>`;
    }
  }

  async function initSupabase() {
    const { url, key } = loadSupabaseConfig();
    if (url && key && window.supabase) {
      state.supabase = window.supabase.createClient(url, key);
      setConnectionStatus('Supabase connected');
      return true;
    }
    state.supabase = null;
    setConnectionStatus('Sample data');
    return false;
  }

  async function fetchSupabaseData() {
    if (!state.supabase) {
      state.projects = sampleData.projects;
      state.quickWins = sampleData.quickWins;
      state.content = sampleData.content;
      return;
    }

    const [projectsRes, quickWinsRes, contentRes] = await Promise.all([
      state.supabase.from('projects').select('*').order('updated_at', { ascending: false }),
      state.supabase.from('quick_wins').select('*').order('estimate_minutes', { ascending: true }),
      state.supabase.from('content_calendar').select('*').order('scheduled_date', { ascending: true })
    ]);

    if (projectsRes.error || quickWinsRes.error || contentRes.error) {
      console.error('Supabase error', projectsRes.error || quickWinsRes.error || contentRes.error);
      state.projects = sampleData.projects;
      state.quickWins = sampleData.quickWins;
      state.content = sampleData.content;
      setConnectionStatus('Sample data (Supabase error)');
      return;
    }

    state.projects = projectsRes.data || [];
    state.quickWins = quickWinsRes.data || [];
    state.content = contentRes.data || [];
  }

  function renderProjects() {
    const container = document.getElementById('project-cards');
    if (!container) return;

    container.innerHTML = state.projects.map(project => {
      const statusClass = `status-${project.status || 'active'}`;
      const progressValue = Math.min(Math.max(project.progress || 0, 0), 100);
      const updatedAt = project.updated_at ? new Date(project.updated_at) : null;
      return `
        <article class="project-card" data-project-id="${project.id}">
          <div class="project-header">
            <div class="project-name">${project.emoji || 'üìå'} ${project.name}</div>
            <span class="neo-status-pill ${statusClass}">${project.status || 'active'}</span>
          </div>
          <div class="progress-track">
            <div class="progress-fill" style="width: ${progressValue}%;"></div>
          </div>
          <div class="progress-row">
            <span>${project.phase || 'Planning'}</span>
            <strong>${progressValue}%</strong>
          </div>
          <div class="project-details">
            <div class="project-detail-row">
              <span class="project-detail-label">Last updated</span>
              <span>${updatedAt ? formatDateLong(updatedAt) + ' ¬∑ ' + formatTime(updatedAt) : '‚Äî'}</span>
            </div>
            <div class="project-detail-row">
              <span class="project-detail-label">PRD</span>
              ${project.prd_path ? `<a class="project-link" href="${project.prd_path}">Open PRD</a>` : '<span>Not linked</span>'}
            </div>
          </div>
        </article>
      `;
    }).join('');

    container.querySelectorAll('.project-card').forEach(card => {
      card.addEventListener('click', () => {
        card.classList.toggle('expanded');
      });
    });
  }

  function renderBlocked() {
    const list = document.getElementById('blocked-list');
    if (!list) return;

    const blockedProjects = state.projects.filter(project => project.status === 'blocked' || project.blocked_reason);
    if (!blockedProjects.length) {
      list.innerHTML = '<div class="data-status">No blockers right now üéâ</div>';
      return;
    }

    list.innerHTML = blockedProjects.map(project => `
      <div class="blocked-item">
        <div><strong>${project.emoji || '‚è∏Ô∏è'} ${project.name}</strong><br>${project.blocked_reason || 'Waiting on Rob'}</div>
        <button data-project-id="${project.id}">Unblock</button>
      </div>
    `).join('');

    list.querySelectorAll('button').forEach(button => {
      button.addEventListener('click', event => {
        event.stopPropagation();
        const projectId = button.getAttribute('data-project-id');
        unblockProject(projectId);
      });
    });
  }

  function renderQuickWins() {
    const container = document.getElementById('quick-wins-list');
    if (!container) return;

    const pending = state.quickWins.filter(item => item.status !== 'done');
    pending.sort((a, b) => (a.estimate_minutes || 0) - (b.estimate_minutes || 0));

    container.innerHTML = pending.map(item => {
      const estimate = item.estimate_minutes ? `${item.estimate_minutes} min` : '‚Äî';
      const showApprove = item.type === 'approve' || item.type === 'review';
      const previewBtn = item.preview_url ? `<a href="${item.preview_url}" class="primary" target="_blank">Preview</a>` : '';
      const actionBtn = item.action_url ? `<a href="${item.action_url}" target="_blank">Action</a>` : '';
      return `
        <div class="quick-win">
          <div class="quick-win-header">
            <div class="quick-win-title">${item.title}</div>
            <div class="quick-win-estimate">${estimate}</div>
          </div>
          <div class="quick-win-actions">
            ${previewBtn}
            ${showApprove ? `<button class="primary" data-approve-id="${item.id}">Approve</button>` : ''}
            ${actionBtn}
            <button class="done" data-done-id="${item.id}">Done</button>
          </div>
          <div class="quick-win-meta">
            <span>Type: ${item.type || 'action'}</span>
            <span>Added: ${item.created_at ? formatDate(new Date(item.created_at)) : '‚Äî'}</span>
          </div>
        </div>
      `;
    }).join('');

    container.querySelectorAll('[data-done-id]').forEach(btn => {
      btn.addEventListener('click', () => markQuickWinDone(btn.getAttribute('data-done-id')));
    });

    container.querySelectorAll('[data-approve-id]').forEach(btn => {
      btn.addEventListener('click', () => approveQuickWin(btn.getAttribute('data-approve-id')));
    });

    const doneToday = state.quickWins.filter(item => item.status === 'done' && item.completed_at && isSameDay(new Date(item.completed_at), new Date())).length;
    const nextUp = pending[0] ? pending[0].title : 'All clear';
    document.getElementById('quick-wins-done').textContent = doneToday;
    document.getElementById('quick-wins-next').textContent = nextUp;
  }

  function renderCalendar() {
    const monthLabel = document.getElementById('calendar-month');
    const weekdays = document.getElementById('calendar-weekdays');
    const daysGrid = document.getElementById('calendar-days');
    if (!monthLabel || !weekdays || !daysGrid) return;

    const month = state.currentMonth;
    monthLabel.textContent = month.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

    weekdays.innerHTML = weekdayLabels.map(day => `<div class="calendar-weekday">${day}</div>`).join('');
    daysGrid.innerHTML = '';

    const firstDay = new Date(month.getFullYear(), month.getMonth(), 1);
    const lastDay = new Date(month.getFullYear(), month.getMonth() + 1, 0);

    const startOffset = (firstDay.getDay() + 6) % 7;
    const totalCells = Math.ceil((startOffset + lastDay.getDate()) / 7) * 7;

    const today = new Date();

    for (let i = 0; i < totalCells; i++) {
      const cellDate = new Date(month.getFullYear(), month.getMonth(), 1 - startOffset + i);
      const isInactive = cellDate.getMonth() !== month.getMonth();
      const isToday = isSameDay(cellDate, today);
      const dateKey = cellDate.toISOString().split('T')[0];
      const items = state.content.filter(item => item.scheduled_date === dateKey);

      const cell = document.createElement('div');
      cell.className = `calendar-day${isInactive ? ' inactive' : ''}${isToday ? ' today' : ''}`;
      cell.dataset.date = dateKey;
      cell.innerHTML = `
        <div class="calendar-date">${cellDate.getDate()}</div>
        <div class="calendar-items">
          ${items.map(item => `<span class="calendar-item status-${item.status}">${channelIcons[item.channel] || 'üìå'}</span>`).join('')}
        </div>
      `;

      cell.addEventListener('click', () => {
        state.selectedDate = dateKey;
        renderDateDetails(dateKey);
      });

      cell.addEventListener('dragover', event => {
        event.preventDefault();
      });

      cell.addEventListener('drop', event => {
        event.preventDefault();
        const itemId = event.dataTransfer.getData('text/plain');
        if (itemId) {
          rescheduleContent(itemId, dateKey);
        }
      });

      daysGrid.appendChild(cell);
    }

    renderCalendarWarning(month);
  }

  function renderDateDetails(dateKey) {
    const title = document.getElementById('calendar-detail-title');
    const list = document.getElementById('calendar-detail-list');
    if (!title || !list) return;

    const date = new Date(dateKey + 'T00:00:00');
    const items = state.content.filter(item => item.scheduled_date === dateKey);

    title.textContent = items.length ? `Scheduled for ${formatDateLong(date)}` : `No content on ${formatDateLong(date)}`;

    if (!items.length) {
      list.innerHTML = '<div class="data-status">No content scheduled.</div>';
      return;
    }

    list.innerHTML = items.map(item => renderContentCard(item)).join('');

    attachContentActions(list);
  }

  function renderUpcoming() {
    const list = document.getElementById('upcoming-list');
    if (!list) return;

    const today = new Date();
    const upcoming = state.content
      .filter(item => new Date(item.scheduled_date + 'T00:00:00') >= new Date(today.toDateString()))
      .sort((a, b) => new Date(a.scheduled_date) - new Date(b.scheduled_date));

    if (!upcoming.length) {
      list.innerHTML = '<div class="data-status">No upcoming content scheduled.</div>';
      return;
    }

    list.innerHTML = upcoming.map(item => `
      <div class="upcoming-item">
        <div><strong>${channelIcons[item.channel] || 'üìå'} ${item.title}</strong></div>
        <div class="meta">${formatDateLong(new Date(item.scheduled_date + 'T00:00:00'))} ¬∑ Status: ${item.status}</div>
        <div class="content-card-actions">
          ${item.preview_url ? `<a href="${item.preview_url}" target="_blank">Preview</a>` : ''}
          ${item.status === 'review' ? `<button class="primary" data-approve-content="${item.id}">Approve</button>` : ''}
          <button data-reschedule="${item.id}">Reschedule</button>
        </div>
      </div>
    `).join('');

    attachContentActions(list);
  }

  function renderCalendarWarning(month) {
    const warning = document.getElementById('calendar-warning');
    if (!warning) return;

    const start = new Date(month.getFullYear(), month.getMonth(), 1);
    const end = new Date(month.getFullYear(), month.getMonth() + 1, 0);
    let hasEmail = false;

    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
      const dateKey = d.toISOString().split('T')[0];
      if (state.content.some(item => item.scheduled_date === dateKey && item.channel === 'email')) {
        hasEmail = true;
        break;
      }
    }

    if (!hasEmail) {
      warning.textContent = '‚ö†Ô∏è Content gap: No email scheduled this month.';
      warning.style.display = 'block';
    } else {
      warning.style.display = 'none';
    }
  }

  function renderContentCard(item) {
    return `
      <div class="content-card" draggable="true" data-content-id="${item.id}">
        <div class="content-card-header">
          <span>${channelIcons[item.channel] || 'üìå'} ${item.title}</span>
          <span class="calendar-item status-${item.status}">${item.status}</span>
        </div>
        <div class="content-card-actions">
          ${item.preview_url ? `<a href="${item.preview_url}" target="_blank">Preview</a>` : ''}
          ${item.status === 'review' ? `<button class="primary" data-approve-content="${item.id}">Approve</button>` : ''}
          <button data-reschedule="${item.id}">Reschedule</button>
        </div>
      </div>
    `;
  }

  function attachContentActions(container) {
    container.querySelectorAll('[data-approve-content]').forEach(btn => {
      btn.addEventListener('click', () => approveContent(btn.getAttribute('data-approve-content')));
    });

    container.querySelectorAll('[data-reschedule]').forEach(btn => {
      btn.addEventListener('click', () => {
        const newDate = prompt('Reschedule to (YYYY-MM-DD):');
        if (newDate) {
          rescheduleContent(btn.getAttribute('data-reschedule'), newDate);
        }
      });
    });

    container.querySelectorAll('[data-content-id]').forEach(card => {
      card.addEventListener('dragstart', event => {
        event.dataTransfer.setData('text/plain', card.getAttribute('data-content-id'));
      });
    });
  }

  function isSameDay(a, b) {
    return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate();
  }

  async function markQuickWinDone(id) {
    const item = state.quickWins.find(win => String(win.id) === String(id));
    if (!item) return;

    item.status = 'done';
    item.completed_at = new Date().toISOString();

    if (state.supabase) {
      await state.supabase.from('quick_wins').update({ status: 'done', completed_at: item.completed_at }).eq('id', id);
    }

    renderQuickWins();
  }

  async function approveQuickWin(id) {
    const item = state.quickWins.find(win => String(win.id) === String(id));
    if (!item) return;

    item.status = 'done';
    item.completed_at = new Date().toISOString();

    if (state.supabase) {
      await state.supabase.from('quick_wins').update({ status: 'done', completed_at: item.completed_at }).eq('id', id);
    }

    renderQuickWins();
  }

  async function unblockProject(id) {
    const project = state.projects.find(proj => String(proj.id) === String(id));
    if (!project) return;

    project.status = 'active';
    project.blocked_reason = null;

    if (state.supabase) {
      await state.supabase.from('projects').update({ status: 'active', blocked_reason: null }).eq('id', id);
    }

    renderProjects();
    renderBlocked();
  }

  async function approveContent(id) {
    const item = state.content.find(content => String(content.id) === String(id));
    if (!item) return;

    item.status = 'approved';
    if (state.supabase) {
      await state.supabase.from('content_calendar').update({ status: 'approved' }).eq('id', id);
    }

    refreshCalendarViews();
  }

  async function rescheduleContent(id, dateKey) {
    const item = state.content.find(content => String(content.id) === String(id));
    if (!item) return;

    item.scheduled_date = dateKey;

    if (state.supabase) {
      await state.supabase.from('content_calendar').update({ scheduled_date: dateKey }).eq('id', id);
    }

    refreshCalendarViews();
  }

  function refreshCalendarViews() {
    renderCalendar();
    if (state.selectedDate) {
      renderDateDetails(state.selectedDate);
    }
    renderUpcoming();
  }

  async function addQuickWin() {
    const title = prompt('Quick win title:');
    if (!title) return;

    const estimate = parseInt(prompt('Estimate minutes (5, 10, 15):') || '10', 10);
    const type = prompt('Type (approve/review/signup/decision/action):') || 'action';

    const newWin = {
      id: state.supabase ? crypto.randomUUID() : `qw-${Date.now()}`,
      title,
      estimate_minutes: estimate,
      type,
      status: 'pending',
      created_at: new Date().toISOString()
    };

    state.quickWins.push(newWin);

    if (state.supabase) {
      await state.supabase.from('quick_wins').insert([
        {
          id: newWin.id,
          title: newWin.title,
          estimate_minutes: newWin.estimate_minutes,
          type: newWin.type,
          status: newWin.status,
          created_at: newWin.created_at
        }
      ]);
    }

    renderQuickWins();
  }

  async function initializeDashboard() {
    await initSupabase();
    await fetchSupabaseData();

    renderProjects();
    renderBlocked();
    renderQuickWins();
    renderCalendar();
    renderUpcoming();

    const todayKey = new Date().toISOString().split('T')[0];
    state.selectedDate = todayKey;
    renderDateDetails(todayKey);
  }

  document.getElementById('prev-month').addEventListener('click', () => {
    state.currentMonth = new Date(state.currentMonth.getFullYear(), state.currentMonth.getMonth() - 1, 1);
    refreshCalendarViews();
  });

  document.getElementById('next-month').addEventListener('click', () => {
    state.currentMonth = new Date(state.currentMonth.getFullYear(), state.currentMonth.getMonth() + 1, 1);
    refreshCalendarViews();
  });

  document.getElementById('today-month').addEventListener('click', () => {
    state.currentMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
    refreshCalendarViews();
  });

  document.getElementById('refresh-data').addEventListener('click', async () => {
    await fetchSupabaseData();
    renderProjects();
    renderBlocked();
    renderQuickWins();
    refreshCalendarViews();
  });

  document.getElementById('toggle-connection').addEventListener('click', () => {
    const panel = document.getElementById('connection-panel');
    panel.style.display = panel.style.display === 'none' ? 'grid' : 'none';
  });

  document.getElementById('save-connection').addEventListener('click', async () => {
    const url = document.getElementById('supabase-url').value.trim();
    const key = document.getElementById('supabase-key').value.trim();
    if (!url || !key) {
      alert('Please enter both the Supabase URL and anon key.');
      return;
    }
    localStorage.setItem('neoSupabaseUrl', url);
    localStorage.setItem('neoSupabaseAnonKey', key);
    await initializeDashboard();
  });

  document.getElementById('clear-connection').addEventListener('click', () => {
    localStorage.removeItem('neoSupabaseUrl');
    localStorage.removeItem('neoSupabaseAnonKey');
    initializeDashboard();
  });

  document.getElementById('add-quick-win').addEventListener('click', addQuickWin);

  window.addEventListener('DOMContentLoaded', () => {
    const { url, key } = loadSupabaseConfig();
    document.getElementById('supabase-url').value = url || '';
    document.getElementById('supabase-key').value = key || '';
    initializeDashboard();
  });
</script>
